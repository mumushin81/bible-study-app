/**
 * 개선된 창세기 1장 이모지 매핑 - 중복 최소화 및 의미 연관성 강화
 */

import * as fs from 'fs';
import * as path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// 개선된 이모지 매핑 - 우선순위 기반
const improvedMapping: Record<string, string> = {
  // ========== 핵심 신학 용어 (고유 이모지) ==========
  'אֱלֹהִים': '👑',  // 하나님 - 왕관
  'בְּרֵאשִׁית': '🌅',  // 태초 - 일출
  'בָּרָא': '✨',  // 창조하다 - 반짝임
  'וַיִּבְרָא': '✨',  // 그리고 창조했다

  // ========== 말씀 관련 ==========
  'אָמַר': '💬',  // 말씀하다
  'וַיֹּאמֶר': '💬',  // 그리고 말씀하셨다
  'לֵאמֹר': '📣',  // 말하기를

  // ========== 보다/인식 ==========
  'רָאָה': '👀',  // 보다
  'וַיַּרְא': '👁️',  // 그리고 보셨다
  'הִנֵּה': '👀',  // 보라
  'וְהִנֵּה': '👀',  // 그리고 보라

  // ========== 좋다/축복 ==========
  'טוֹב': '💚',  // 좋은
  'בָּרַךְ': '🙏',  // 축복하다
  'כִּי': '✅',  // ~라는 것 (확인)
  'מְאֹד': '💯',  // 매우

  // ========== 자연 - 천체/빛 ==========
  'אוֹר': '💡',  // 빛
  'הָאוֹר': '⭐',  // 그 빛
  'חֹשֶׁךְ': '🌑',  // 어둠
  'הַחֹשֶׁךְ': '🌚',  // 그 어둠

  // 시간
  'יוֹם': '☀️',  // 낮/날
  'הַיּוֹם': '🌞',  // 그 낮
  'בַּיּוֹם': '📅',  // 날에
  'לַיְלָה': '🌙',  // 밤
  'הַלָּיְלָה': '🌜',  // 그 밤
  'הַלַּיְלָה': '🌛',  // 그 밤
  'וּבַלַּיְלָה': '🌙',  // 그리고 밤에
  'עֶרֶב': '🌆',  // 저녁
  'בֹקֶר': '🌄',  // 아침
  'וְשָׁנִים': '🗓️',  // 그리고 해들

  // 천체
  'מָאוֹר': '💫',  // 광명체
  'מְאֹרֹת': '🌟',  // 광명체들
  'לִמְאוֹרֹת': '✨',  // 광명체들로
  'הַמְּאֹרֹת': '🌠',  // 그 광명체들
  'הַמָּאוֹר': '⭐',  // 그 광명체
  'שֶׁמֶשׁ': '☀️',  // 해
  'יָרֵחַ': '🌙',  // 달
  'כּוֹכָב': '⭐',  // 별
  'כּוֹכָבִים': '✨',  // 별들

  // ========== 자연 - 하늘/궁창 ==========
  'שָׁמַיִם': '☁️',  // 하늘
  'הַשָּׁמַיִם': '🌥️',  // 그 하늘
  'הַשָּׁמָיִם': '🌤️',  // 하늘
  'רָקִיעַ': '🌈',  // 궁창
  'הָרָקִיעַ': '🌠',  // 그 궁창
  'לָרָקִיעַ': '🌌',  // 궁창에
  'בִּרְקִיעַ': '🌃',  // 궁창에
  'רְקִיעַ': '🌅',  // 궁창

  // ========== 자연 - 땅/육지 ==========
  'אֶרֶץ': '🌍',  // 땅
  'הָאָרֶץ': '🌎',  // 그 땅
  'הַיַּבָּשָׁה': '🏞️',  // 그 마른 땅
  'לַיַּבָּשָׁה': '🏜️',  // 마른 땅에게

  // ========== 자연 - 물 ==========
  'מַיִם': '💧',  // 물
  'הַמַּיִם': '💦',  // 그 물들
  'לָמָיִם': '🌊',  // 물들에게
  'תְהוֹם': '🌊',  // 심연
  'יַמִּים': '🏖️',  // 바다들
  'הַיָּם': '🌊',  // 그 바다
  'מִקְוֵה': '🏊',  // 모임

  // ========== 혼돈과 질서 ==========
  'תֹהוּ': '🌀',  // 혼돈
  'בֹהוּ': '〰️',  // 공허
  'תֹהוּ וָבֹהוּ': '🌀',  // 혼돈하고 공허함
  'רוּחַ': '💨',  // 영/바람
  'מְרַחֶפֶת': '🕊️',  // 운행하다
  'בָּדַל': '✂️',  // 나누다
  'קָבַץ': '🔄',  // 모으다
  'יִקָּווּ': '🌊',  // 모이라

  // ========== 식물 ==========
  'דֶּשֶׁא': '🌱',  // 풀
  'עֵשֶׂב': '🌿',  // 초목
  'עֵץ': '🌳',  // 나무
  'פְּרִי': '🍎',  // 열매
  'זֶרַע': '🌾',  // 씨앗
  'זַרְעוֹ': '🌱',  // 그것의 씨
  'מַזְרִיעַ': '🌾',  // 씨를 맺는
  'זֹרֵעַ': '🌱',  // 씨를 뿌리는
  'לְמִינוֹ': '🧬',  // 그 종류대로
  'לְמִינֵהוּ': '🧬',  // 그것의 종류대로

  // ========== 동물 ==========
  'תַּנִּין': '🐋',  // 큰 물고기
  'הַתַּנִּינִם': '🐳',  // 큰 바다 짐승들
  'נֶפֶשׁ': '🐟',  // 생명/혼
  'חַיָּה': '🦁',  // 짐승/살아있는
  'וְחַיְתוֹ': '🦒',  // 그리고 짐승
  'חַיַּת': '🐅',  // 짐승
  'הַחַיָּה': '🦓',  // 살아있는
  'עוֹף': '🦅',  // 새
  'וְעוֹף': '🦆',  // 그리고 새
  'הָעוֹף': '🐦',  // 그 새
  'וְהָעוֹף': '🕊️',  // 그리고 새
  'וּבְעוֹף': '🦜',  // 그리고 새에
  'דָּג': '🐟',  // 물고기
  'בִדְגַת': '🐠',  // 물고기에
  'בְּהֵמָה': '🐄',  // 가축
  'רֶמֶשׂ': '🦎',  // 기는 것
  'הָרֹמֶשֶׂת': '🐛',  // 움직이는

  // ========== 인간 ==========
  'אָדָם': '👤',  // 사람
  'הָאָדָם': '🧑',  // 그 사람
  'זָכָר': '👨',  // 남자
  'נְקֵבָה': '👩',  // 여자
  'צֶלֶם': '🎭',  // 형상
  'דְּמוּת': '🪞',  // 모양

  // ========== 동사 - 행위 ==========
  'עָשָׂה': '🔨',  // 만들다
  'וַיַּעַשׂ': '⚒️',  // 그리고 만드셨다
  'עֹשֶׂה': '🛠️',  // 만드는
  'נָתַן': '🎁',  // 주다
  'קָרָא': '📢',  // 부르다
  'יָצָא': '🚪',  // 나오다
  'שָׁרַץ': '🐣',  // 번성하다
  'יִשְׁרְצוּ': '🦐',  // 떼를 지어 번성하게 하라
  'שָׁרְצוּ': '🦗',  // 떼지어 번성했다
  'רָבָה': '📈',  // 많아지다
  'וּרְבוּ': '📊',  // 그리고 번성하라
  'יִרֶב': '📈',  // 번성하게 하라
  'פְּרוּ': '🌸',  // 생육하라
  'מָלֵא': '🌊',  // 가득하다
  'וּמִלְאוּ': '🌊',  // 그리고 채우라
  'רָדָה': '👑',  // 다스리다
  'כָּבַשׁ': '⚔️',  // 정복하다
  'לְהָאִיר': '💡',  // 비추기 위하여

  // ========== 접속사/연결어 ==========
  'וְ': '🔗',  // 그리고
  'וְאֵת': '➕',  // 그리고 (목적격)
  'וַיְהִי': '✓',  // 그리고 되었다
  'יְהִי': '💫',  // ~이 되라
  'וִיהִי': '⚡',  // 그리고 그것이 되라
  'כֵן': '✅',  // 그렇게

  // ========== 문법 요소 ==========
  'אֵת': '🎯',  // 목적격 표지
  'אֶת': '📍',  // 목적격 표지
  'אֹתָם': '👥',  // 그것들을/그들을
  'אֹתוֹ': '👆',  // 그를
  'עַל': '🔝',  // ~위에
  'מֵעַל': '⬆️',  // 위에서
  'תַּחַת': '🔽',  // ~아래
  'מִתַּחַת': '⬇️',  // 아래에서
  'בֵּין': '↔️',  // ~사이
  'וּבֵין': '⟷',  // 그리고 사이에
  'אֶל': '➡️',  // ~으로, ~에게
  'לְ': '👉',  // ~에게
  'מִן': '⬅️',  // ~로부터
  'בּ': '📌',  // ~에
  'בְּתוֹךְ': '🎯',  // 가운데에
  'בוֹ': '📦',  // 그 안에
  'לָהֶם': '👫',  // 그들에게
  'לָכֶם': '🫵',  // 너희에게
  'אֲשֶׁר': '🔍',  // ~하는
  'מָקוֹם': '📍',  // 장소

  // ========== 서수 ==========
  'שֵׁנִי': '2️⃣',  // 둘째
  'שְׁלִישִׁי': '3️⃣',  // 셋째
  'רְבִיעִי': '4️⃣',  // 넷째
  'חֲמִישִׁי': '5️⃣',  // 다섯째
  'שִׁשִּׁי': '6️⃣',  // 여섯째

  // ========== 형용사 ==========
  'הַגָּדֹל': '🔶',  // 큰 것
  'הַגְּדֹלִים': '🔷',  // 큰 것들
  'הַקָּטֹן': '🔸',  // 작은 것
};

function applyImprovedEmojis() {
  const versesPath = path.join(__dirname, '../src/data/verses.ts');
  let content = fs.readFileSync(versesPath, 'utf-8');

  // Genesis 1 구간만 수정
  const gen1Start = content.indexOf("id: 'gen1-1'");
  const gen1End = content.indexOf("id: 'gen2-1'");

  if (gen1Start === -1) {
    console.error('창세기 1장을 찾을 수 없습니다.');
    return;
  }

  const beforeGen1 = content.substring(0, gen1Start);
  const gen1Content = content.substring(gen1Start, gen1End > 0 ? gen1End : content.length);
  const afterGen1 = gen1End > 0 ? content.substring(gen1End) : '';

  // 각 단어의 emoji 교체
  let updatedGen1 = gen1Content;
  let replacementCount = 0;

  // 히브리어로 매칭하여 emoji 교체
  for (const [hebrew, emoji] of Object.entries(improvedMapping)) {
    const regex = new RegExp(
      `(hebrew:\\s*'${hebrew.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}',.*?emoji:\\s*)'[^']*'`,
      'gs'
    );

    const matches = updatedGen1.match(regex);
    if (matches) {
      updatedGen1 = updatedGen1.replace(regex, `$1'${emoji}'`);
      replacementCount += matches.length;
    }
  }

  // 파일 다시 쓰기
  const finalContent = beforeGen1 + updatedGen1 + afterGen1;
  fs.writeFileSync(versesPath, finalContent, 'utf-8');

  console.log('✅ 개선된 이모지 매핑 적용 완료!');
  console.log(`📊 총 ${replacementCount}개 이모지 교체됨`);
  console.log(`🎨 ${Object.keys(improvedMapping).length}개 히브리어 단어에 고유 이모지 매핑`);
}

applyImprovedEmojis();
