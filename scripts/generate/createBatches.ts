#!/usr/bin/env tsx

import fs from 'fs'
import path from 'path'

interface VerseInfo {
  id: string
  chapter: number
  verse: number
  hebrew: string
}

const verses: VerseInfo[] = [
  { id: 'genesis_2_1', chapter: 2, verse: 1, hebrew: 'וַיְכֻלּוּ הַשָּׁמַיִם וְהָאָרֶץ, וְכָל-צְבָאָם.' },
  { id: 'genesis_2_2', chapter: 2, verse: 2, hebrew: 'וַיְכַל אֱלֹהִים בַּיּוֹם הַשְּׁבִיעִי, מְלַאכְתּוֹ אֲשֶׁר עָשָׂה; וַיִּשְׁבֹּת בַּיּוֹם הַשְּׁבִיעִי, מִכָּל-מְלַאכְתּוֹ אֲשֶׁר עָשָׂה.' },
  { id: 'genesis_2_4', chapter: 2, verse: 4, hebrew: 'אֵלֶּה תוֹלְדוֹת הַשָּׁמַיִם וְהָאָרֶץ, בְּהִבָּרְאָם:  בְּיוֹם, עֲשׂוֹת יְהוָה אֱלֹהִים--אֶרֶץ וְשָׁמָיִם.' },
  { id: 'genesis_2_5', chapter: 2, verse: 5, hebrew: 'וְכֹל שִׂיחַ הַשָּׂדֶה, טֶרֶם יִהְיֶה בָאָרֶץ, וְכָל-עֵשֶׂב הַשָּׂדֶה, טֶרֶם יִצְמָח:  כִּי לֹא הִמְטִיר יְהוָה אֱלֹהִים, עַל-הָאָרֶץ, וְאָדָם אַיִן, לַעֲבֹד אֶת-הָאֲדָמָה.' },
  { id: 'genesis_2_6', chapter: 2, verse: 6, hebrew: 'וְאֵד, יַעֲלֶה מִן-הָאָרֶץ, וְהִשְׁקָה, אֶת-כָּל-פְּנֵי הָאֲדָמָה.' },
  { id: 'genesis_2_7', chapter: 2, verse: 7, hebrew: 'וַיִּיצֶר יְהוָה אֱלֹהִים אֶת-הָאָדָם, עָפָר מִן-הָאֲדָמָה, וַיִּפַּח בְּאַפָּיו, נִשְׁמַת חַיִּים; וַיְהִי הָאָדָם, לְנֶפֶשׁ חַיָּה.' },
  { id: 'genesis_2_8', chapter: 2, verse: 8, hebrew: 'וַיִּטַּע יְהוָה אֱלֹהִים, גַּן-בְּעֵדֶן--מִקֶּדֶם; וַיָּשֶׂם שָׁם, אֶת-הָאָדָם אֲשֶׁר יָצָר.' },
  { id: 'genesis_2_9', chapter: 2, verse: 9, hebrew: 'וַיַּצְמַח יְהוָה אֱלֹהִים, מִן-הָאֲדָמָה, כָּל-עֵץ נֶחְמָד לְמַרְאֶה, וְטוֹב לְמַאֲכָל--וְעֵץ הַחַיִּים, בְּתוֹךְ הַגָּן, וְעֵץ, הַדַּעַת טוֹב וָרָע.' },
  { id: 'genesis_2_10', chapter: 2, verse: 10, hebrew: 'וְנָהָר יֹצֵא מֵעֵדֶן, לְהַשְׁקוֹת אֶת-הַגָּן; וּמִשָּׁם, יִפָּרֵד, וְהָיָה, לְאַרְבָּעָה רָאשִׁים.' },
  { id: 'genesis_2_11', chapter: 2, verse: 11, hebrew: 'שֵׁם הָאֶחָד, פִּישׁוֹן--הוּא הַסֹּבֵב, אֵת כָּל-אֶרֶץ הַחֲוִילָה, אֲשֶׁר-שָׁם, הַזָּהָב.' },
  { id: 'genesis_2_12', chapter: 2, verse: 12, hebrew: 'וּזְהַב הָאָרֶץ הַהִוא, טוֹב; שָׁם הַבְּדֹלַח, וְאֶבֶן הַשֹּׁהַם.' },
  { id: 'genesis_2_13', chapter: 2, verse: 13, hebrew: 'וְשֵׁם-הַנָּהָר הַשֵּׁנִי, גִּיחוֹן--הוּא הַסּוֹבֵב, אֵת כָּל-אֶרֶץ כּוּשׁ.' },
  { id: 'genesis_2_14', chapter: 2, verse: 14, hebrew: 'וְשֵׁם הַנָּהָר הַשְּׁלִישִׁי חִדֶּקֶל, הוּא הַהֹלֵךְ קִדְמַת אַשּׁוּר; וְהַנָּהָר הָרְבִיעִי, הוּא פְרָת.' },
  { id: 'genesis_2_15', chapter: 2, verse: 15, hebrew: 'וַיִּקַּח יְהוָה אֱלֹהִים, אֶת-הָאָדָם; וַיַּנִּחֵהוּ בְגַן-עֵדֶן, לְעָבְדָהּ וּלְשָׁמְרָהּ.' },
  { id: 'genesis_2_16', chapter: 2, verse: 16, hebrew: 'וַיְצַו יְהוָה אֱלֹהִים, עַל-הָאָדָם לֵאמֹר:  מִכֹּל עֵץ-הַגָּן, אָכֹל תֹּאכֵל.' },
  { id: 'genesis_2_17', chapter: 2, verse: 17, hebrew: 'וּמֵעֵץ, הַדַּעַת טוֹב וָרָע--לֹא תֹאכַל, מִמֶּנּוּ:  כִּי, בְּיוֹם אֲכָלְךָ מִמֶּנּוּ--מוֹת תָּמוּת.' },
  { id: 'genesis_2_18', chapter: 2, verse: 18, hebrew: 'וַיֹּאמֶר יְהוָה אֱלֹהִים, לֹא-טוֹב הֱיוֹת הָאָדָם לְבַדּוֹ; אֶעֱשֶׂה-לּוֹ עֵזֶר, כְּנֶגְדּוֹ.' },
  { id: 'genesis_2_19', chapter: 2, verse: 19, hebrew: 'וַיִּצֶר יְהוָה אֱלֹהִים מִן-הָאֲדָמָה, כָּל-חַיַּת הַשָּׂדֶה וְאֵת כָּל-עוֹף הַשָּׁמַיִם, וַיָּבֵא אֶל-הָאָדָם, לִרְאוֹת מַה-יִּקְרָא-לוֹ; וְכֹל אֲשֶׁר יִקְרָא-לוֹ הָאָדָם נֶפֶשׁ חַיָּה, הוּא שְׁמוֹ.' },
  { id: 'genesis_2_20', chapter: 2, verse: 20, hebrew: 'וַיִּקְרָא הָאָדָם שֵׁמוֹת, לְכָל-הַבְּהֵמָה וּלְעוֹף הַשָּׁמַיִם, וּלְכֹל, חַיַּת הַשָּׂדֶה; וּלְאָדָם, לֹא-מָצָא עֵזֶר כְּנֶגְדּוֹ.' },
  { id: 'genesis_2_21', chapter: 2, verse: 21, hebrew: 'וַיַּפֵּל יְהוָה אֱלֹהִים תַּרְדֵּמָה עַל-הָאָדָם, וַיִּישָׁן; וַיִּקַּח, אַחַת מִצַּלְעֹתָיו, וַיִּסְגֹּר בָּשָׂר, תַּחְתֶּנָּה.' },
  { id: 'genesis_2_22', chapter: 2, verse: 22, hebrew: 'וַיִּבֶן יְהוָה אֱלֹהִים אֶת-הַצֵּלָע אֲשֶׁר-לָקַח מִן-הָאָדָם, לְאִשָּׁה; וַיְבִאֶהָ, אֶל-הָאָדָם.' },
  { id: 'genesis_2_23', chapter: 2, verse: 23, hebrew: 'וַיֹּאמֶר, הָאָדָם, זֹאת הַפַּעַם עֶצֶם מֵעֲצָמַי, וּבָשָׂר מִבְּשָׂרִי; לְזֹאת יִקָּרֵא אִשָּׁה, כִּי מֵאִישׁ לֻקְחָה-זֹּאת.' },
  { id: 'genesis_2_24', chapter: 2, verse: 24, hebrew: 'עַל-כֵּן, יַעֲזָב-אִישׁ, אֶת-אָבִיו, וְאֶת-אִמּוֹ; וְדָבַק בְּאִשְׁתּוֹ, וְהָיוּ לְבָשָׂר אֶחָד.' },
  { id: 'genesis_2_25', chapter: 2, verse: 25, hebrew: 'וַיִּהְיוּ שְׁנֵיהֶם עֲרוּמִּים, הָאָדָם וְאִשְׁתּוֹ; וְלֹא, יִתְבֹּשָׁשׁוּ.' }
]

// 10개 배치로 나누기
const batches: VerseInfo[][] = [
  verses.slice(0, 2),    // 배치 1: 2개
  verses.slice(2, 4),    // 배치 2: 2개
  verses.slice(4, 7),    // 배치 3: 3개
  verses.slice(7, 9),    // 배치 4: 2개
  verses.slice(9, 12),   // 배치 5: 3개
  verses.slice(12, 14),  // 배치 6: 2개
  verses.slice(14, 16),  // 배치 7: 2개
  verses.slice(16, 19),  // 배치 8: 3개
  verses.slice(19, 21),  // 배치 9: 2개
  verses.slice(21, 24)   // 배치 10: 3개
]

function createPromptFile(batchNum: number, verses: VerseInfo[]) {
  const versesList = verses.map(v => `
**창세기 ${v.chapter}:${v.verse}** (ID: ${v.id})
- Book ID: genesis
- Chapter: ${v.chapter}
- Verse: ${v.verse}
- Hebrew: ${v.hebrew}
`).join('\n')

  const verseIds = verses.map(v => `  { "verseId": "${v.id}", ... }`).join(',\n')

  const content = `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📖 구절 컨텐츠 생성 요청 - 배치 ${batchNum}/10 (병렬 작업용)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 생성 대상 구절 (${verses.length}개)
${versesList}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 작업 요청

다음 ${verses.length}개 구절에 대해 **전체 컨텐츠**를 생성해주세요:
1. IPA 발음
2. 한글 발음
3. 현대어 의역
4. 단어 분석 (words)
5. 주석 (commentary)

**각 구절마다** 다음 형식의 JSON을 생성해주세요:

\`\`\`json
{
  "verseId": "${verses[0].id}",
  "ipa": "히브리어 전체의 IPA 발음",
  "koreanPronunciation": "히브리어 전체의 한글 발음",
  "modern": "현대어 자연스러운 의역 (한 문장)",
  "words": [
    {
      "hebrew": "히브리어 단어",
      "meaning": "한국어 의미",
      "ipa": "IPA 발음",
      "korean": "한글 발음",
      "root": "히브리어 어근 (한글 발음)",
      "grammar": "문법 정보",
      "emoji": "이모지 (필수)"
    }
  ],
  "commentary": {
    "intro": "서론 2-3문장",
    "sections": [
      {
        "emoji": "1️⃣",
        "title": "히브리어 (한글 발음) - 설명",
        "description": "단어/개념 설명 2-3문장",
        "points": ["포인트1", "포인트2", "포인트3"],
        "color": "purple"
      }
    ],
    "whyQuestion": {
      "question": "어린이를 위한 질문",
      "answer": "어린이가 이해할 수 있는 답변 3-5문장",
      "bibleReferences": ["책 장:절 - '인용문'"]
    },
    "conclusion": {
      "title": "💡 신학적 의미",
      "content": "신학적 의미 2-3문장"
    }
  }
}
\`\`\`

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 출력 형식

**JSON 배열로 출력해주세요:**

\`\`\`json
[
${verseIds}
]
\`\`\`

생성이 완료되면:
1. 결과를 \`data/generated/genesis_2_batch${batchNum}.json\`으로 저장
2. 다음 명령어로 Supabase에 저장:

\`\`\`bash
npm run save:content -- data/generated/genesis_2_batch${batchNum}.json
\`\`\`

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**참고:** VERSE_CREATION_GUIDELINES.md 문서를 참고하여 정확한 형식으로 작성해주세요!

이제 위 ${verses.length}개 구절에 대한 컨텐츠를 생성해주세요! 🙏
`

  const filename = `genesis_2_batch${batchNum}.md`
  const filepath = path.join(process.cwd(), 'data/prompts', filename)
  fs.writeFileSync(filepath, content, 'utf8')
  console.log(`✅ 생성: ${filename}`)
}

console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━')
console.log('📝 창세기 2장 - 10개 배치 프롬프트 파일 생성 중...')
console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━')
console.log('')

batches.forEach((batch, index) => {
  createPromptFile(index + 1, batch)
})

console.log('')
console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━')
console.log('✅ 10개 배치 프롬프트 파일 생성 완료!')
console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━')
console.log('')
console.log('📁 생성된 파일:')
batches.forEach((batch, index) => {
  console.log(`   - genesis_2_batch${index + 1}.md (${batch.length}개 구절)`)
})
